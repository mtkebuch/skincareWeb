<div class="orders-container" *ngIf="!orderId && currentUser">
  <div class="orders-header">
    <button class="back-btn" (click)="goBack()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="19" y1="12" x2="5" y2="12"/>
        <polyline points="12 19 5 12 12 5"/>
      </svg>
      <span>Back to Home</span>
    </button>
    <div class="header-title-section">
      <h1>My Orders</h1>
      <p class="order-count">{{ userOrders.length }} {{ userOrders.length === 1 ? 'order' : 'orders' }}</p>
    </div>
  </div>

  <div class="empty-state" *ngIf="userOrders.length === 0">
    <div class="empty-icon">
      <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <circle cx="9" cy="21" r="1"></circle>
        <circle cx="20" cy="21" r="1"></circle>
        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
      </svg>
    </div>
    <h2>No orders yet</h2>
    <p>You haven't placed any orders yet. Start shopping to see your orders here!</p>
    <button class="shop-now-btn" (click)="goBack()">
      <span>Start Shopping</span>
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="5" y1="12" x2="19" y2="12"/>
        <polyline points="12 5 19 12 12 19"/>
      </svg>
    </button>
  </div>

  <!-- Orders List -->
  <div class="orders-list" *ngIf="userOrders.length > 0">
    <div class="order-card" *ngFor="let orderItem of userOrders" (click)="viewOrderDetails(orderItem.orderId)">
      <div class="order-card-header">
        <div class="order-id-section">
          <span class="order-label">Order ID</span>
          <span class="order-id">{{ orderItem.orderId }}</span>
        </div>
        <span class="order-status" [ngClass]="getStatusClass(orderItem.status)">
          {{ orderItem.status }}
        </span>
      </div>

      <div class="order-date">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
          <line x1="16" y1="2" x2="16" y2="6"/>
          <line x1="8" y1="2" x2="8" y2="6"/>
          <line x1="3" y1="10" x2="21" y2="10"/>
        </svg>
        <span>{{ formatDate(orderItem.orderDate) }}</span>
      </div>

      <!-- ✅ შეცვლილი: getImageUrl() დამატებული -->
      <div class="order-items-preview">
        <div class="item-preview" *ngFor="let item of orderItem.items.slice(0, 3)">
          <img [src]="getImageUrl(item.image)" [alt]="item.name" (error)="onImageError($event)">
        </div>
        <div class="items-count" *ngIf="orderItem.items.length > 3">
          +{{ orderItem.items.length - 3 }} more
        </div>
      </div>

      <div class="order-footer">
        <div class="order-info">
          <span class="items-total">{{ orderItem.items.length }} {{ orderItem.items.length === 1 ? 'item' : 'items' }}</span>
          <span class="payment-method">{{ orderItem.paymentMethod === 'card' ? 'Card' : 'Cash on Delivery' }}</span>
        </div>
        <div class="order-total-inline">
          <span class="total-label">Total</span>
          <span class="total-amount">€{{ orderItem.total }}</span>
        </div>
      </div>

      <button class="view-details-btn">
        <span>View Details</span>
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="5" y1="12" x2="19" y2="12"/>
          <polyline points="12 5 19 12 12 19"/>
        </svg>
      </button>
    </div>
  </div>
</div>

<!-- Show Order Details if orderId exists -->
<div class="confirmation-container" *ngIf="orderId && order">
  <!-- Back to Orders Button -->
  <div class="back-to-orders">
    <button class="back-btn" (click)="backToOrders()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="19" y1="12" x2="5" y2="12"/>
        <polyline points="12 19 5 12 12 5"/>
      </svg>
      <span>Back to Orders</span>
    </button>
  </div>

  <!-- Success Animation (only for new orders) -->
  <div class="success-animation" *ngIf="isNewOrder">
    <div class="checkmark-circle">
      <svg class="checkmark" width="80" height="80" viewBox="0 0 52 52">
        <circle class="checkmark-circle-path" cx="26" cy="26" r="25" fill="none"/>
        <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
      </svg>
    </div>
  </div>

  <!-- Success Message -->
  <div class="success-message">
    <h1>{{ isNewOrder ? 'Order Placed Successfully!' : 'Order Details' }}</h1>
    <p *ngIf="isNewOrder">Thank you for your purchase. We've received your order and will process it shortly.</p>
  </div>

  <!-- Order Details -->
  <div class="order-details-card">
    <div class="order-header">
      <h2>Order Details</h2>
      <div class="order-id">
        <span class="label">Order ID:</span>
        <span class="value">{{ order.orderId }}</span>
      </div>
    </div>

    <div class="detail-row">
      <span class="label">Order Date:</span>
      <span class="value">{{ formatDate(order.orderDate) }}</span>
    </div>

    <div class="detail-row">
      <span class="label">Status:</span>
      <span class="status-badge">{{ order.status }}</span>
    </div>

    <div class="detail-row">
      <span class="label">Payment Method:</span>
      <span class="value">{{ order.paymentMethod === 'card' ? 'Credit/Debit Card' : 'Cash on Delivery' }}</span>
    </div>
  </div>

  <!-- Shipping Address -->
  <div class="info-card">
    <h3>Shipping Address</h3>
    <div class="address-info">
      <p><strong>{{ order.shippingAddress.firstName }} {{ order.shippingAddress.lastName }}</strong></p>
      <p>{{ order.shippingAddress.address }}</p>
      <p>{{ order.shippingAddress.city }}, {{ order.shippingAddress.postalCode }}</p>
      <p>{{ order.shippingAddress.country }}</p>
      <p class="contact-info">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
          <polyline points="22,6 12,13 2,6"/>
        </svg>
        {{ order.shippingAddress.email }}
      </p>
      <p class="contact-info">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
        </svg>
        {{ order.shippingAddress.phone }}
      </p>
    </div>
  </div>

  <!-- Order Items -->
  <div class="info-card">
    <h3>Order Items</h3>
    <div class="order-items">
      <!-- ✅ შეცვლილი: getImageUrl() დამატებული -->
      <div class="order-item" *ngFor="let item of order.items">
        <img [src]="getImageUrl(item.image)" [alt]="item.name" (error)="onImageError($event)">
        <div class="item-details">
          <h4>{{ item.name }}</h4>
          <p>{{ item.volume }}</p>
          <p class="quantity">Quantity: {{ item.quantity }}</p>
        </div>
        <div class="item-price">€{{ item.price * item.quantity }}</div>
      </div>
    </div>
  </div>

  <!-- Order Summary -->
  <div class="info-card summary-card">
    <h3>Order Summary</h3>
    <div class="summary-rows">
      <div class="summary-row">
        <span>Subtotal</span>
        <span>€{{ order.subtotal }}</span>
      </div>
      <div class="summary-row">
        <span>Shipping</span>
        <span>{{ order.shipping === 0 ? 'FREE' : '€' + order.shipping }}</span>
      </div>
      <div class="summary-row total">
        <span>Total</span>
        <span>€{{ order.total }}</span>
      </div>
    </div>
  </div>

  <div class="additional-info" *ngIf="isNewOrder">
    <p>
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <line x1="12" y1="16" x2="12" y2="12"/>
        <line x1="12" y1="8" x2="12.01" y2="8"/>
      </svg>
      A confirmation email has been sent to <strong>{{ order.shippingAddress.email }}</strong>
    </p>
  </div>
</div>

<div class="loading-state" *ngIf="!order && orderId">
  <div class="spinner"></div>
  <p>Loading order details...</p>
</div>